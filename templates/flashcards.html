<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flashcards</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .container { max-width: 500px; margin: 0 auto; }
        .flashcard {
            background: white;
            border-radius: 20px;
            padding: 40px;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 1.4em;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            position: relative;
        }
        .flashcard.flipped { transform: rotateY(180deg); }
        .flashcard-front, .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            box-sizing: border-box;
        }
        .flashcard-back {
            transform: rotateY(180deg);
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 20px;
        }
        .nav-btns { display: flex; justify-content: center; gap: 20px; margin: 30px 0; }
        .nav-btn { padding: 15px 40px; border: none; border-radius: 10px; font-size: 1.1em; cursor: pointer; }
        .nav-btn.prev { background: #6c757d; color: white; }
        .nav-btn.next { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .progress { text-align: center; color: #666; margin-bottom: 20px; }
        .add-card { background: white; padding: 25px; border-radius: 15px; margin-top: 30px; box-shadow: 0 3px 15px rgba(0,0,0,0.1); }
        .add-card input, .add-card textarea { width: 100%; padding: 12px; border: 2px solid #eee; border-radius: 10px; margin-bottom: 10px; box-sizing: border-box; }
        .add-card button { padding: 12px 30px; background: #27ae60; color: white; border: none; border-radius: 10px; cursor: pointer; }
        .card-list { margin-top: 30px; }
        .card-item { background: white; padding: 15px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .delete-btn { background: #e74c3c; color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; }
    </style>
</head>
<body class="app-body">
    <div class="app-container">
        <main class="main-content" style="padding: 20px;">
            <a href="{{ url_for('home') }}" style="color: #667eea; text-decoration: none;">‚Üê Orqaga</a>
            <h1 style="text-align: center;">Flashcards</h1>

            <div class="container">
                {% if kartalar %}
                <div class="progress"><span id="current">1</span> / {{ kartalar|length }}</div>
                <div class="flashcard" id="flashcard" onclick="flipCard()">
                    <div class="flashcard-front" id="front"></div>
                    <div class="flashcard-back" id="back"></div>
                </div>
                <div class="nav-btns">
                    <button class="nav-btn prev" onclick="prevCard()">‚Üê Oldingi</button>
                    <button class="nav-btn next" onclick="nextCard()">Keyingi ‚Üí</button>
                </div>
                {% else %}
                <div style="text-align: center; color: #999; padding: 60px;">
                    <p style="font-size: 3em;">üìö</p>
                    <p>Hali kartalar yo'q. Quyida yangi karta qo'shing!</p>
                </div>
                {% endif %}

                <div class="add-card">
                    <h3 style="margin-bottom: 15px;">Yangi karta qo'shish</h3>
                    <input type="text" id="cardQuestion" placeholder="Savol (old tomoni)">
                    <textarea id="cardAnswer" rows="2" placeholder="Javob (orqa tomoni)"></textarea>
                    <button onclick="addCard()">Qo'shish</button>
                </div>

                {% if kartalar %}
                <div class="card-list">
                    <h3>Barcha kartalar ({{ kartalar|length }})</h3>
                    {% for karta in kartalar %}
                    <div class="card-item">
                        <span>{{ karta.savol[:30] }}...</span>
                        <button class="delete-btn" onclick="deleteCard({{ karta.id }})">O'chirish</button>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
        </main>
    </div>

    <script>
        const cards = {{ kartalar|tojson }};
        let currentIndex = 0;
        let flipped = false;

        function updateCard() {
            if (cards.length === 0) return;
            document.getElementById('front').textContent = cards[currentIndex].savol;
            document.getElementById('back').textContent = cards[currentIndex].javob;
            document.getElementById('current').textContent = currentIndex + 1;
            document.getElementById('flashcard').classList.remove('flipped');
            flipped = false;
        }

        function flipCard() {
            document.getElementById('flashcard').classList.toggle('flipped');
            flipped = !flipped;
        }

        function nextCard() {
            currentIndex = (currentIndex + 1) % cards.length;
            updateCard();
        }

        function prevCard() {
            currentIndex = (currentIndex - 1 + cards.length) % cards.length;
            updateCard();
        }

        function addCard() {
            const savol = document.getElementById('cardQuestion').value.trim();
            const javob = document.getElementById('cardAnswer').value.trim();
            if (!savol || !javob) return alert('Savol va javobni kiriting');

            fetch('/flashcard_qoshish', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({savol, javob})
            }).then(r => r.json()).then(data => {
                if (data.success) location.reload();
            });
        }

        function deleteCard(id) {
            if (!confirm('Rostdan o\'chirmoqchimisiz?')) return;
            fetch('/flashcard_ochirish', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({id})
            }).then(r => r.json()).then(data => {
                if (data.success) location.reload();
            });
        }

        if (cards.length > 0) updateCard();
    </script>
</body>
</html>
