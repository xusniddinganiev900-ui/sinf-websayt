<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Do'stlar</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .friends-container { max-width: 900px; margin: 0 auto; padding: 20px; }
        .section-title { font-size: 1.5em; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .friends-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .friend-card {
            background: white; border-radius: 15px; padding: 20px;
            display: flex; align-items: center; gap: 15px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1); transition: all 0.3s;
        }
        .friend-card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0,0,0,0.15); }
        .friend-avatar { width: 60px; height: 60px; border-radius: 50%; background: #f0f4ff; display: flex; align-items: center; justify-content: center; font-size: 2em; }
        .friend-info { flex: 1; }
        .friend-name { font-weight: bold; font-size: 1.1em; margin-bottom: 5px; }
        .friend-stats { font-size: 13px; color: #666; }
        .friend-actions { display: flex; gap: 8px; }
        .btn-gift, .btn-remove, .btn-add {
            padding: 8px 15px; border: none; border-radius: 20px; cursor: pointer; font-size: 13px;
        }
        .btn-gift { background: linear-gradient(135deg, #f5af19, #f12711); color: white; }
        .btn-remove { background: #e74c3c; color: white; }
        .btn-add { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center; }
        .modal.show { display: flex; }
        .modal-content { background: white; border-radius: 20px; padding: 30px; max-width: 400px; width: 90%; }
        .modal-content h3 { margin-bottom: 20px; }
        .modal-content input { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 10px; margin-bottom: 15px; font-size: 16px; }
        .modal-buttons { display: flex; gap: 10px; }
        .modal-buttons button { flex: 1; padding: 12px; border: none; border-radius: 10px; cursor: pointer; }
        [data-theme="dark"] .friend-card { background: #2d2d2d; }
        [data-theme="dark"] .friend-stats { color: #aaa; }
        [data-theme="dark"] .modal-content { background: #2d2d2d; }
    </style>
</head>
<body class="app-body">
    <div class="app-container">
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="user-avatar"><img src="{{ url_for('static', filename='images/ogil.svg') }}" alt="Avatar"></div>
                <h3>{{ ism }}</h3>
                <p class="ball-display" id="my-ball">{{ foydalanuvchi.ball }} ball</p>
            </div>
            <ul class="nav-menu">
                <li class="nav-item"><a href="{{ url_for('home') }}"><span class="icon">üè†</span> Home</a></li>
                <li class="nav-item"><a href="{{ url_for('kabinet') }}"><span class="icon">üë§</span> Kabinet</a></li>
                <li class="nav-item"><a href="{{ url_for('oyin') }}"><span class="icon">üéÆ</span> Game</a></li>
                <li class="nav-item"><a href="{{ url_for('reyting') }}"><span class="icon">üèÜ</span> Reyting</a></li>
                <li class="nav-item active"><a href="{{ url_for('dostlar') }}"><span class="icon">üë•</span> Do'stlar</a></li>
                <li class="nav-item"><a href="{{ url_for('chat') }}"><span class="icon">üí¨</span> Chat</a></li>
            </ul>
            <div class="sidebar-footer">
                <a href="{{ url_for('chiqish') }}" class="logout-btn"><span class="icon">üö™</span> Chiqish</a>
            </div>
        </nav>

        <main class="main-content">
            <div class="friends-container">
                <h2 class="section-title">üë• Mening do'stlarim ({{ dostlar|length }})</h2>
                {% if dostlar %}
                <div class="friends-grid">
                    {% for dost in dostlar %}
                    <div class="friend-card">
                        <div class="friend-avatar">{{ dost.ism[0] }}</div>
                        <div class="friend-info">
                            <div class="friend-name">{{ dost.ism }}</div>
                            <div class="friend-stats">{{ dost.ball }} ball ‚Ä¢ Mavsum {{ dost.mavsum }}</div>
                        </div>
                        <div class="friend-actions">
                            <button class="btn-gift" onclick="openGiftModal('{{ dost.ism }}')">üéÅ</button>
                            <button class="btn-remove" onclick="removeFriend('{{ dost.ism }}')">‚úï</button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p style="color: #666; text-align: center; padding: 30px;">Hali do'stlar yo'q. Quyidan qo'shing!</p>
                {% endif %}

                <h2 class="section-title">üîç Boshqa o'quvchilar</h2>
                <div class="friends-grid">
                    {% for user in boshqalar %}
                    <div class="friend-card">
                        <div class="friend-avatar">{{ user.ism[0] }}</div>
                        <div class="friend-info">
                            <div class="friend-name">{{ user.ism }}</div>
                            <div class="friend-stats">{{ user.ball }} ball</div>
                        </div>
                        <button class="btn-add" onclick="addFriend('{{ user.ism }}')">+ Do'st</button>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </main>
    </div>

    <div class="modal" id="giftModal">
        <div class="modal-content">
            <h3>üéÅ Sovg'a yuborish</h3>
            <p>Kimga: <strong id="giftRecipient"></strong></p>
            <input type="number" id="giftAmount" placeholder="Miqdor (ball)" min="1" max="1000">
            <div class="modal-buttons">
                <button onclick="closeGiftModal()" style="background: #ccc;">Bekor</button>
                <button onclick="sendGift()" style="background: linear-gradient(135deg, #f5af19, #f12711); color: white;">Yuborish</button>
            </div>
        </div>
    </div>

    <script>
        let currentRecipient = '';
        function openGiftModal(name) {
            currentRecipient = name;
            document.getElementById('giftRecipient').textContent = name;
            document.getElementById('giftModal').classList.add('show');
        }
        function closeGiftModal() { document.getElementById('giftModal').classList.remove('show'); }
        function sendGift() {
            const amount = document.getElementById('giftAmount').value;
            if (!amount || amount <= 0) { alert('Miqdorni kiriting!'); return; }
            fetch('/sovga_yuborish', {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({qabul_qiluvchi: currentRecipient, miqdor: parseInt(amount)})
            }).then(r => r.json()).then(data => {
                if (data.success) { alert(data.xabar); location.reload(); }
                else { alert(data.xato); }
            });
        }
        function addFriend(name) {
            fetch('/dost_qoshish', {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({dost_ism: name})
            }).then(r => r.json()).then(data => {
                if (data.success) { alert(data.xabar); location.reload(); }
                else { alert(data.xato); }
            });
        }
        function removeFriend(name) {
            if (!confirm(name + ' ni do\'stlardan o\'chirmoqchimisiz?')) return;
            fetch('/dost_ochirish', {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({dost_ism: name})
            }).then(r => r.json()).then(data => { if (data.success) location.reload(); });
        }
    </script>
</body>
</html>
